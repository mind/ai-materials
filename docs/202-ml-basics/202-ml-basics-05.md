FIXME
# PCA
主成分分析(Principal components analysis，以下简称PCA)是最重要的降维方法之一。在数据压缩消除冗余和数据噪音消除等领域都有广泛的应用。一般我们提到降维最容易想到的算法就是PCA，下面我们就对PCA的原理做一个总结。

## 1 PCA的思想
PCA顾名思义，就是找出数据里最主要的方面，用数据里最主要的方面来代替原始数据。具体的，假如我们的数据集是$n$维的，共有$m$个数据$(x^{(1)},x^{(2)},...,x^{(m)})$。我们希望将这$m$个数据的维度从$n$维降到$n'$维，希望这$m$个$n'$维的数据集尽可能的代表原始数据集。我们知道数据从$n$维降到$n'$维肯定会有损失，但是我们希望损失尽可能的小。那么如何让这$n'$维的数据尽可能表示原来的数据呢？

我们先看看最简单的情况，也就是$n=2$，$n'=1$,也就是将数据从二维降维到一维。数据如下图。我们希望找到某一个维度方向，它可以代表这两个维度的数据。图中列了两个向量方向，$u1$和$u2$，那么哪个向量可以更好的代表原始数据集呢？从直观上也可以看出，$u1$比$u2$好。

为什么$u1$比$u2$好呢？可以有两种解释，第一种解释是样本点到这个直线的距离足够近，第二种解释是样本点在这个直线上的投影能尽可能的分开。

假如我们把$n'$从1维推广到任意维，则我们的希望降维的标准为：样本点到这个超平面的距离足够近,或者说样本点在这个超平面上的投影能尽可能的分开。

基于上面的两种标准，我们可以得到PCA的两种等价推导。

## 2 PCA的推导: 基于小于投影距离

我们首先看第一种解释的推导，即样本点到这个超平面的距离足够近。

假设m个n维数据$(x^{(1)},x^{(2)},...,x^{(m)})$都已经进行了中心化，即$\sum \limits_{i=1}^{m} x^{(i)}=0$。经过投影变换后得到的新坐标系为${w_1,w_2,...,w_n}$，其中$w$是标准正交基，即$\|w\|_2=1$，$w_i^Tw_j=0$。

如果我们将数据从$n$维降到$n'$维，即丢弃新坐标系中的部分坐标，则新的坐标系为${w_1,w_2,...,w_n'}$，样本点$x^{(i)}$在$n'$维坐标系中的投影为：$z^(i)=(z_1^{(i)},z_2^{(i)},...,z_{n'}^{(i)})$。其中，$z_j^{(i)}=w_j^Tx^{(i)}$是$x^{(i)}$在低维坐标系里第$j$维的坐标。

如果我们用$z^{(i)}$来恢复原始数据$x^{(i)}$，则得到的恢复数据$\bar{x}^{(i)}=\sum \limits_{j=1}^{n'} z_j^{(i)} w_j = W_z^{(i)}$，其中，$W$为标准正交基组成的矩阵。

现在我们考虑整个样本集，我们希望所有的样本到这个超平面的距离足够近，即最小化下式：
$$
\sum \limits_{i=1}^m \|\bar{x}^{(i)}-x^{(i)}\|_2^2
$$
将这个式子进行整理，可以得到:
$$
\begin{align}
\sum \limits_{i=1}^m \|\bar{x}^{(i)}-x^{(i)}\|_2^2 &= \sum \limits_{i=1}^m \|Wz^{(i)}-x^{(i)}\|_2^2 \\
& = \sum \limits_{i=1}^m (Wz^{(i)T}) (Wz^{(i)}) - 2 \sum \limits_{i=1}^m (Wz^{(i)T}) x^{(i)} \\
& = \sum \limits_{i=1}^m z^{(i)T} z^{(i)} - 2 \sum \limits_{i=1}^m z^{(i)T} W^T x^{(i)} + \sum \limits_{i=1}^m x^{(i)T} x^{(i)} \\
& = \sum \limits_{i=1}^m z^{(i)T} z^{(i)} - 2 \sum \limits_{i=1}^m z^{(i)T} z^{(i)} + \sum \limits_{i=1}^m x^{(i)T} x^{(i)}\\
& = -\sum \limits_{i=1}^m z^{(i)T}z^{(i)}+\sum \limits_{i=1}^m x^{(i)T} x^{(i)} \\
& = -tr(W^T (\sum \limits_{i=1}^m x^{(i)} x^{(i)T})W) + \sum \limits_{i=1}^m x^{(i)T} x^{(i)} \\
& = -tr(W^TXX^TW) + \sum \limits_{i=1}^m x^{(i)T} x^{(i)}
\end{align}
$$
注意到$\sum \limits_{i=1}^m x^{(i)} x^{(i)T}$是数据集的协方差矩阵，$W$的每一个向量wj是标准正交基。而$\sum \limits_{i=1}^m x^{(i)} x^{(i)T}$是一个常量。最小化上式等价于：
$$
arg \min \limits_W -tr(W^TXX^TW) s.t. W^TW=I
$$

这个最小化不难，直接观察也可以发现最小值对应的$W$由协方差矩阵$XX^T$最大的$n'$个特征值对应的特征向量组成。当然用数学推导也很容易。利用拉格朗日函数可以得到
$$
J(W)=-tr(W^TXX^TW)+\lambda(W^TW-I)
$$

对$W$求导有$-XX^TW+\lambda W = 0$，整理下即为: 
$$
XX^TW = \lambda W
$$

这样可以更清楚的看出，$W$为$XX^T$的$n'$个特征向量组成的矩阵，而$\lambda$为$XX^T$的特征值当我们将数据集从$n$维降到$n'$维时，需要找到最大的$n'$个特征值对应的特征向量。这$n'$个特征向量组成的矩阵$W$即为我们需要的矩阵。对于原始数据集，我们只需要用$z^{(i)} = W^T x^{(i)}$，就可以把原始数据集降维到最小投影距离的$n'$维数据集。

如果你熟悉谱聚类的优化过程，就会发现和PCA的非常类似，只不过谱聚类是求前$k$个最小的特征值对应的特征向量，而PCA是求前k个最大的特征值对应的特征向量。

## 3 PCA的推导: 基于最大投影方差

现在我们再来看看基于最大投影方差的推导。

假设$m$个$n$维数据$(x^{(1)},x^{(2)},...,x^{(m)})$都已经进行了中心化，即$\sum \limits_{i=1}^m x^{(i)}=0$。经过投影变换后得到的新坐标系为${w_1,w_2,...,w_n}$，其中$w$是标准正交基，即$\|w\|_2 = 1$，$w_i^T w_j = 0$。

如果我们将数据从$n$维降到$n'$维，即丢弃新坐标系中的部分坐标，则新的坐标系为$\{w_1,w_2,...,w_{n'}\}$，样本点$x^{(i)}$在$n'$维坐标系中的投影为: $z^{(i)}=(z_1^{(i)},z_2^{(i)},...,z_{n'}^{(i)})$。其中，$z_j^{(i)}=w_j^T x^{(i)}$是$x^{(i)}$在低维坐标系里第$j$维的坐标。

对于任意一个样本$x^{(i)}$，在新的坐标系中的投影为$W^T x^{(i)}$，在新坐标系中的投影方差为$W^Tx^{(i)}x^{(i)T}W$，要使所有的样本的投影方差和最大，也就是最大化$\sum \limits_{i=1}^m W^T x^{(i) x^{(i)T}W}$，即：
$$
arg \max \limits_w tr(W^TXX^TW)+\lambda(W^TW-I)
$$
对$W$求导有$XX^TW+\lambda W=0$，整理下即使为:
$$
XX^TW=-\lambda W
$$
和上面一样可以看出，$W$为XX^T的$n'$个特征向量组成的矩阵，而$-\lambda$为$XX^T$的特征值。当我们将数据集从$n$维降到$n'$维时，需要找到最大的$n'$个特征值对应的特征向量。这$n'$个特征向量组成的矩阵W即为我们需要的矩阵。对于原始数据集，我们只需要用$z^{(i)}=W^Tx^{(i)}$，就可以把原始数据集降维到最小投影距离的$n'$维数据集。

## 4 PCA算法流程
从上面两节我们可以看出，求样本$x(i)$的$n'$维的主成分其实就是求样本集的协方差矩阵$XX^T$的前$n'$个特征值对应特征向量矩阵$W$，然后对于每个样本$x^{(i)}$,做如下变换$z^{(i)}=W^Tx^{(i)}$，即达到降维的PCA目的。

下面我们看看具体的算法流程。

输入：$n$维样本集$D=(x^{(1)},x^{(2)},...,x^{(m)})$，要降维到的维数$n'$。

输出：降维后的样本集$D′$

1. 对所有的样本进行中心化：$x^{(i)}=x^{(i)}−\dfrac1m \sum \limits_{j=1}^m x^{(j)}$

2. 计算样本的协方差矩阵$XX^T$

3. 对矩阵$XX^T$进行特征值分解

4. 取出最大的$n'$个特征值对应的特征向量$(w_1,w_2,...,w_{n′})$，将所有的特征向量标准化后，组成特征向量矩阵$W$。

5. 对样本集中的每一个样本$x^{(i)}$，转化为新的样本$z^{(i)}=W^Tx^{(i)}$

6. 得到输出样本集$D′=(z^{(1)},z^{(2)},...,z^{(m)})$

有时候，我们不指定降维后的$n'$的值，而是换种方式，指定一个降维到的主成分比重阈值$t$。这个阈值$t$在$(0,1]$之间。假如我们的$n$个特征值为$\lambda_1 \geq \lambda_2 \geq ... \geq \lambda_n$，则$n'$可以通过下式得到:
$$
\dfrac{\sum \limits_{i=1}^{n'}\lambda_i}{\sum \limits_{i=1}^n \lambda_i} \geq t
$$

## 5 PCA实例
下面举一个简单的例子，说明PCA的过程。

假设我们的数据集有10个二维数据(2.5,2.4), (0.5,0.7), (2.2,2.9), (1.9,2.2), (3.1,3.0), (2.3, 2.7), (2, 1.6), (1, 1.1), (1.5, 1.6), (1.1, 0.9)，需要用PCA降到1维特征。

首先我们对样本中心化，这里样本的均值为(1.81, 1.91),所有的样本减去这个均值后，即中心化后的数据集为(0.69, 0.49), (-1.31, -1.21), (0.39, 0.99), (0.09, 0.29), (1.29, 1.09), (0.49, 0.79), (0.19, -0.31), (-0.81, -0.81), (-0.31, -0.31), (-0.71, -1.01)。

现在我们开始求样本的协方差矩阵，由于我们是二维的，则协方差矩阵为：
$$
XX^T=\left(\begin{matrix}cov(x_1,x_1)&cov(x_1,x_2)\\cov(x_2,x_1)&cov(x_2,x_2)\end{matrix}\right)
$$
对于我们的数据，求出协方差矩阵为：
$$
XX^T=\left(\begin{matrix} 0.62 & 0.62 \\ 0.62 & 0.72 \end{matrix}\right)
$$
求出特征值为(0.49， 1.28)，对应的特征向量分别为：$(0.74,0.68)^T (−0.68,−0.74)^T$，由于最大的$k=1$个特征值为1.28，对于的$k=1$个特征向量为$(−0.68,−0.74)^T$. 则我们的$W=(−0.68,−0.74)^T$

我们对所有的数据集进行投影$z^{(i)}=W^Tx^{(i)}$，得到PCA降维后的10个一维数据集为：(-0.83, 1.78,-0.99,-0.27,-1.68,-0.91,0.10,1.14,0.44,1.22)

## 6 PCA算法总结

这里对PCA算法做一个总结。作为一个非监督学习的降维方法，它只需要特征值分解，就可以对数据进行压缩，去噪。因此在实际场景应用很广泛。为了克服PCA的一些缺点，出现了很多PCA的变种，比如第六节的为解决非线性降维的KPCA，还有解决内存限制的增量PCA方法Incremental PCA，以及解决稀疏数据降维的PCA方法Sparse PCA等。

PCA算法的主要优点有：

- 仅仅需要以方差衡量信息量，不受数据集以外的因素影响。　
- 各主成分之间正交，可消除原始数据成分间的相互影响的因素。
- 计算方法简单，主要运算是特征值分解，易于实现。
PCA算法的主要缺点有：
- 主成分各个特征维度的含义具有一定的模糊性，不如原始样本特征的解释性强。
- 方差小的非主成分也可能含有对样本差异的重要信息，因降维丢弃可能对后续数据处理有影响。